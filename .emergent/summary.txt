<analysis>
The AI engineer's work involved an extensive, iterative debugging process to get the Kwezi app to a functional state, primarily focusing on resolving persistent EAS Android APK build failures due to complex Kotlin/Gradle version incompatibilities. Initial attempts involved direct  and  modifications,  updates, and dependency force resolutions in , which repeatedly failed. After numerous cycles and  interventions, the strategy pivoted multiple times: from forcing Kotlin versions to upgrading , then downgrading React Native, and finally attempting local Android builds. When all build attempts failed, the focus shifted to a web PWA. Subsequent web preview failures ( error) on restored stable Git versions led to the conclusion that the existing project state was problematic. The current effort involves creating a completely new, clean Expo project and migrating the functional code, but disk space issues and persistent  configuration problems were encountered during this migration, leading to a recommendation for a fresh start with a detailed specification in a new session.
</analysis>

<product_requirements>
The Kwezi application is an educational platform for learning ShimaorÃ© and Kibouchi, aiming for Google Play Store deployment with a freemium model. Free users access 250 words, while premium users unlock full content (635+ words), PDF exercise sheets, and an offline audio mode. The app features refined Text-to-Speech, extensive authentic audio streamed from Cloudflare R2 CDN (via a FastAPI backend), paginated learning, word search, interactive games, and legal documents. The primary objective has been to achieve a stable Android APK that correctly connects to the backend, displays all data, supports premium offline features, and has a functional payment system (Stripe). Prior issues included non-functional APKs, slow word loading, broken audio, search, and payment, and unenforced word limits. The latest priority shifted to getting a functional web application (PWA) as a temporary solution while Android APK issues persist. The current problem is to get the application working in an Emergent web preview or Expo Go, as historical versions also failed.
</product_requirements>

<key_technical_concepts>
-   **Full-Stack Architecture:** Expo (React Native) frontend, FastAPI (Python) backend, MongoDB Atlas.
-   **Monetization:** Stripe for freemium subscriptions.
-   **Routing:** Expo Router for file-based navigation.
-   **Build & Deployment:** Expo Application Services (EAS) for Android, Render.com for backend, Cloudflare R2 (CDN) for audio.
-   **Core Libraries:** React Native components, , , Node.js, Gradle, Kotlin.
-   **State Management:** React Context (UserContext).
</key_technical_concepts>

<code_architecture>

-   ****: Main FastAPI backend. Configured to serve audio from Cloudflare R2 CDN via .
-   ****: Stores .
-   ****: Core Expo config. Iteratively updated , , and . Plugins like  were removed during troubleshooting.
-   ****: EAS build config.  was adjusted for Node.js, and a new  profile was added to try to bypass cache.
-   ****: Frontend dependencies. Iteratively updated , , 
  Usage: expo [command] [options]

  Options:
  
    -V, --version                     output the version number
    --non-interactive                 Fail, if an interactive prompt would be required to continue.
    -h, --help                        output usage information
  
  Commands:

    init [name]                       Create a new Expo project
    start [path]                      Start a local dev server for the app
    start:web [path]                  Start a Webpack dev server for the web app
    export [path]                     Export the static files of the app for hosting it on a web server
    install [packages...]             Install a module or other package to a project
    run:android [path]                Run the Android app binary locally
    run:ios [path]                    Run the iOS app binary locally
    send [path]                       Share the project's URL to an email address

    login                             Login to an Expo account
    logout                            Logout of an Expo account
    register                          Sign up for a new Expo account
    whoami                            Return the currently authenticated account

    client:install:ios                Install Expo Go for iOS on the simulator
    client:install:android            Install Expo Go for Android on a connected device or emulator

    config [path]                     Show the project config
    doctor [path]                     Diagnose issues with the project
    upgrade [sdk-version]             Upgrade the project packages and config for the given SDK version

    customize:web [path]              Eject the default web files for customization
    prebuild [path]                   Create native iOS and Android project files before building natively.
                                      Learn more: https://docs.expo.dev/workflow/customizing/

    build:web [path]                  Build the web app for production

    credentials:manager [path]        Superseded by eas credentials in eas-cli

    url [path]                        Log a URL for opening the project in Expo Go
    url:ipa [path]                    Log the download URL for the standalone iOS binary
    url:apk [path]                    Log the download URL for the standalone Android binary

    webhooks [path]                   List all webhooks for a project
    webhooks:add [path]               Add a webhook to a project
    webhooks:remove [path]            Delete a webhook
    webhooks:update [path]            Update an existing webhook

    build:ios [path]                  Superseded by eas build in eas-cli
    build:android [path]              Superseded by eas build in eas-cli
    build:status [path]               Superseded by eas build:list in eas-cli
    eject [path]                      Superseded by expo prebuild
    fetch:ios:certs [path]            Superseded by eas credentials in eas-cli
    fetch:android:keystore [path]     Superseded by eas credentials in eas-cli
    fetch:android:hashes [path]       Superseded by eas credentials in eas-cli
    fetch:android:upload-cert [path]  Superseded by eas credentials in eas-cli
    publish [path]                    Superseded by eas update in eas-cli
    publish:set [path]                Superseded by eas update:republish in eas-cli
    publish:rollback [path]           Superseded by eas update:republish in eas-cli
    publish:history [path]            Superseded by eas update:list in eas-cli
    publish:details [path]            Superseded by eas update:view in eas-cli
    push:android:upload [path]        Superseded by eas credentials in eas-cli
    push:android:show [path]          Superseded by eas credentials in eas-cli
    push:android:clear [path]         Superseded by eas credentials in eas-cli
    upload:android [path]             Superseded by eas submit in eas-cli
    upload:ios [path]                 Superseded by eas submit in eas-cli
    client:ios [path]                 Superseded by Expo Dev Clients

[09:29:10]   Run a command with --help for more info ðŸ’¡
[09:29:10]     $ expo start --help
[09:29:10], , and added  to force specific versions, then removed. Critical  entry point ()
-   ****: Android build config.  (to 1.9.0, then 2.1.20, then 1.8.22) and Android Gradle Plugin (to 8.7.3) were iteratively modified and forced. Dependency resolutions were added/removed.
-   ****: Android project settings.  and  blocks were added and reordered to resolve Kotlin/Gradle conflicts. Obsolete React Native CLI line commented out.
-   ****: Updated  to use Gradle 8.7, then 8.9.
-   ****: Manages user session and premium status. Critically, the  statement and  type were repeatedly fixed due to compatibility issues.
-   ****: Manages audio playback from R2 with TTS fallback.
-   ****: A newly created clean Expo project to migrate existing functional code to. This is the current working directory for the frontend. Its  was simplified, and , , ,  were installed as missing dependencies during migration.
-   ****: Supervisor config file. Modified to point the 
  Usage: expo [command] [options]

  Options:
  
    -V, --version                     output the version number
    --non-interactive                 Fail, if an interactive prompt would be required to continue.
    -h, --help                        output usage information
  
  Commands:

    init [name]                       Create a new Expo project
    start [path]                      Start a local dev server for the app
    start:web [path]                  Start a Webpack dev server for the web app
    export [path]                     Export the static files of the app for hosting it on a web server
    install [packages...]             Install a module or other package to a project
    run:android [path]                Run the Android app binary locally
    run:ios [path]                    Run the iOS app binary locally
    send [path]                       Share the project's URL to an email address

    login                             Login to an Expo account
    logout                            Logout of an Expo account
    register                          Sign up for a new Expo account
    whoami                            Return the currently authenticated account

    client:install:ios                Install Expo Go for iOS on the simulator
    client:install:android            Install Expo Go for Android on a connected device or emulator

    config [path]                     Show the project config
    doctor [path]                     Diagnose issues with the project
    upgrade [sdk-version]             Upgrade the project packages and config for the given SDK version

    customize:web [path]              Eject the default web files for customization
    prebuild [path]                   Create native iOS and Android project files before building natively.
                                      Learn more: https://docs.expo.dev/workflow/customizing/

    build:web [path]                  Build the web app for production

    credentials:manager [path]        Superseded by eas credentials in eas-cli

    url [path]                        Log a URL for opening the project in Expo Go
    url:ipa [path]                    Log the download URL for the standalone iOS binary
    url:apk [path]                    Log the download URL for the standalone Android binary

    webhooks [path]                   List all webhooks for a project
    webhooks:add [path]               Add a webhook to a project
    webhooks:remove [path]            Delete a webhook
    webhooks:update [path]            Update an existing webhook

    build:ios [path]                  Superseded by eas build in eas-cli
    build:android [path]              Superseded by eas build in eas-cli
    build:status [path]               Superseded by eas build:list in eas-cli
    eject [path]                      Superseded by expo prebuild
    fetch:ios:certs [path]            Superseded by eas credentials in eas-cli
    fetch:android:keystore [path]     Superseded by eas credentials in eas-cli
    fetch:android:hashes [path]       Superseded by eas credentials in eas-cli
    fetch:android:upload-cert [path]  Superseded by eas credentials in eas-cli
    publish [path]                    Superseded by eas update in eas-cli
    publish:set [path]                Superseded by eas update:republish in eas-cli
    publish:rollback [path]           Superseded by eas update:republish in eas-cli
    publish:history [path]            Superseded by eas update:list in eas-cli
    publish:details [path]            Superseded by eas update:view in eas-cli
    push:android:upload [path]        Superseded by eas credentials in eas-cli
    push:android:show [path]          Superseded by eas credentials in eas-cli
    push:android:clear [path]         Superseded by eas credentials in eas-cli
    upload:android [path]             Superseded by eas submit in eas-cli
    upload:ios [path]                 Superseded by eas submit in eas-cli
    client:ios [path]                 Superseded by Expo Dev Clients

[09:29:11]   Run a command with --help for more info ðŸ’¡
[09:29:11]     $ expo start --help
[09:29:11] program's  and  to  for the new project.
</code_architecture>

<pending_tasks>
-   **Verify Frontend Functionality (APK):** A successful Android APK build is still pending.
-   **Fix Payment System:** Address the utilisateur non identifiÃ© error for premium subscriptions.
-   **Enforce 250-word Free Limit:** Implement and verify the visible enforcement of the 250-word limit for free users.
-   **Complete Web Application Migration:** Finish migrating all remaining functional code from  to , resolve the current 500 runtime error in the web preview, and then deploy it to Vercel.
</pending_tasks>

<current_work>
Immediately before this summary, the AI engineer was in the process of creating a new, clean Expo project in  and migrating the existing functional code from . This approach was chosen after numerous failed attempts to build an Android APK via EAS and to get a stable web preview from the original project.

The migration process involved:
1.  Creating the new Expo project.
2.  Installing essential dependencies (, , , , , etc.) that were identified as missing during successive web preview attempts.
3.  Copying the backend to the new project structure.
4.  Copying frontend assets, utils, components, contexts (including ), and screens to .
5.  Fixing the  import and  type issues.
6.  Simplifying  in  by removing build-specific plugins like  to get the web preview working.
7.  Updating the  to correctly point the 
  Usage: expo [command] [options]

  Options:
  
    -V, --version                     output the version number
    --non-interactive                 Fail, if an interactive prompt would be required to continue.
    -h, --help                        output usage information
  
  Commands:

    init [name]                       Create a new Expo project
    start [path]                      Start a local dev server for the app
    start:web [path]                  Start a Webpack dev server for the web app
    export [path]                     Export the static files of the app for hosting it on a web server
    install [packages...]             Install a module or other package to a project
    run:android [path]                Run the Android app binary locally
    run:ios [path]                    Run the iOS app binary locally
    send [path]                       Share the project's URL to an email address

    login                             Login to an Expo account
    logout                            Logout of an Expo account
    register                          Sign up for a new Expo account
    whoami                            Return the currently authenticated account

    client:install:ios                Install Expo Go for iOS on the simulator
    client:install:android            Install Expo Go for Android on a connected device or emulator

    config [path]                     Show the project config
    doctor [path]                     Diagnose issues with the project
    upgrade [sdk-version]             Upgrade the project packages and config for the given SDK version

    customize:web [path]              Eject the default web files for customization
    prebuild [path]                   Create native iOS and Android project files before building natively.
                                      Learn more: https://docs.expo.dev/workflow/customizing/

    build:web [path]                  Build the web app for production

    credentials:manager [path]        Superseded by eas credentials in eas-cli

    url [path]                        Log a URL for opening the project in Expo Go
    url:ipa [path]                    Log the download URL for the standalone iOS binary
    url:apk [path]                    Log the download URL for the standalone Android binary

    webhooks [path]                   List all webhooks for a project
    webhooks:add [path]               Add a webhook to a project
    webhooks:remove [path]            Delete a webhook
    webhooks:update [path]            Update an existing webhook

    build:ios [path]                  Superseded by eas build in eas-cli
    build:android [path]              Superseded by eas build in eas-cli
    build:status [path]               Superseded by eas build:list in eas-cli
    eject [path]                      Superseded by expo prebuild
    fetch:ios:certs [path]            Superseded by eas credentials in eas-cli
    fetch:android:keystore [path]     Superseded by eas credentials in eas-cli
    fetch:android:hashes [path]       Superseded by eas credentials in eas-cli
    fetch:android:upload-cert [path]  Superseded by eas credentials in eas-cli
    publish [path]                    Superseded by eas update in eas-cli
    publish:set [path]                Superseded by eas update:republish in eas-cli
    publish:rollback [path]           Superseded by eas update:republish in eas-cli
    publish:history [path]            Superseded by eas update:list in eas-cli
    publish:details [path]            Superseded by eas update:view in eas-cli
    push:android:upload [path]        Superseded by eas credentials in eas-cli
    push:android:show [path]          Superseded by eas credentials in eas-cli
    push:android:clear [path]         Superseded by eas credentials in eas-cli
    upload:android [path]             Superseded by eas submit in eas-cli
    upload:ios [path]                 Superseded by eas submit in eas-cli
    client:ios [path]                 Superseded by Expo Dev Clients

[09:29:11]   Run a command with --help for more info ðŸ’¡
[09:29:11]     $ expo start --help
[09:29:11] program's  and  to .

Despite these efforts, the  is still showing an Error 500 Internal Server Error, indicating a persistent runtime issue in the newly migrated codebase. Disk space usage is also at 97%. The AI engineer has provided a comprehensive specification document for the application to facilitate starting a new, clean session to complete the migration and deployment.
</current_work>

<optional_next_step>
Start a new session to migrate existing functional code to a new project () following the provided specification.
</optional_next_step>
